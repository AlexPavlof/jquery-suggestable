!function(e){"use strict";var t=38,s=40,a=13,g=108,n=27;e.fn.suggestable=function(i){var r=e.extend({"data-url":"suggestable-url","container-class":"suggestable-container","item-class":"suggestable-item","item-active-class":"suggestable-item-active","term-class":"suggestable-term","suggest-class":"suggestable-suggest","delimiter-text":" â€” ","delimiter-class":"suggestable-delimiter","text-class":"suggestable-text","term-min-length":3},i),u="."+r["item-class"],l=-1,d={},c=function(t){var s=(t.attr("id")||"sb"+Math.round(9999*Math.random())+1)+"__container",a=e("#"+s);return a.length<1?e("<ul/>",{class:r["container-class"],id:s}).css({"margin-top":t.outerHeight(!0)+"px",display:"none"}).insertAfter(t):a.first()};e(document).on("mouseover",u,function(t){l=e(t.target).data("suggest-index"),e(document).trigger("suggestable-item-select",[e(t.target)])}).on("mouseout",u,function(t){l=-1,e(document).trigger("suggestable-item-unselect",[e(t.target)])}).on("mouseup",function(t){var s=e("."+r["container-class"]);s.is(t.target)||0!==s.has(t.target).length||e(document).trigger("suggestable-hide",[s])}).on("suggestable-hide",function(e,t){t.hide()}).on("suggestable-show",function(e,t){l=-1,t.show()}).on("suggestable-item-select",function(e,t){t.closest("."+r["container-class"]).children().removeClass(r["item-active-class"]),t.addClass(r["item-active-class"])}).on("suggestable-item-unselect",function(e,t){t.removeClass(r["item-active-class"])}),e(this).attr("autocomplete","off").on("keydown",function(n){var i,r=n.keyCode||n.which,d=e(n.target),o=c(d);if(o.is(":visible")){switch(r){case a||g:o.find("[data-suggest-index="+l+"]").trigger("click");break;case t:l=-1===l||l<=e(u,o).first().data("suggest-index")?e(u,o).last().data("suggest-index"):o.find("[data-suggest-index="+(l-1)+"]").data("suggest-index"),(i=o.find("[data-suggest-index="+l+"]")).trigger("mouseover"),d.val(i.data("suggest-data"));break;case s:l=-1===l||l>=e(u,o).last().data("suggest-index")?e(u,o).first().data("suggest-index"):o.find("[data-suggest-index="+(l+1)+"]").data("suggest-index"),(i=o.find("[data-suggest-index="+l+"]")).trigger("mouseover"),d.val(i.data("suggest-data"))}if(-1!==[s,t,a,g].indexOf(r)&&-1!==l)return!1}return e(document).on("click",u,function(t){d.val(e(t.target).data("suggest-data")),e(document).trigger("suggestable-hide",[o]).trigger("suggestable-click",[e(t.target)])}),!0}).on("keyup",function(i){var u=e(i.target),l=i.keyCode||i.which,o=c(u),m=u.data(r["data-url"]),f=u.val(),h=function(t){var s=0,a=e("<li/>",{class:r["item-class"]}).hide();if(t.length>0){for(o.empty(),s=0;s<t.length;s++)a.empty(),a.append(e("<span/>",{class:r["term-class"]}).text(f)).append(e("<span/>",{class:r["suggest-class"]}).text(t[s].query.substr(f.length))).attr("data-suggest-data",t[s].query).attr("data-suggest-index",s).attr("data-suggest-url",t[s]["suggest-url"]),""!==t[s]["suggest-text"]&&a.append(e("<span/>",{class:r["delimiter-class"]}).text(r["delimiter-text"])).append(e("<span/>",{class:r["text-class"]}).text(t[s]["suggest-text"])),o.append(a.show().clone());e(document).trigger("suggestable-show",[o])}};return-1===[s,t,a,g,n].indexOf(l)&&(f.length>=r["term-min-length"]?d.hasOwnProperty(m+":"+f)?h(d[m+":"+f]):e.get(m,{term:f},function(e){d[m+":"+f]=e,h(d[m+":"+f])},"json"):e(document).trigger("suggestable-hide",[o])),!o.is(":visible")||l!==n||(e(document).trigger("suggestable-hide",[c(u)]),!1)})}}(jQuery);
