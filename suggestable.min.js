(function(e){var c=38,d=40,b=13,f=108,a=27;e.fn.suggestable=function(k){var i=e.extend({"data-url":"suggestable-url","container-class":"suggestable-container","item-class":"suggestable-item","item-active-class":"suggestable-item-active","term-class":"suggestable-term","suggest-class":"suggestable-suggest","term-min-length":3},k),h="."+i["item-class"],j=-1,g={},l=function(p){var q=p.attr("id")||("sb"+Math.round(Math.random()*9999)+1),n=q+"__container",m="#"+n,o=e(m);if(o.size()<1){return e("<ul/>",{"class":i["container-class"],id:n}).css({"margin-top":p.outerHeight(true)+"px",display:"none"}).insertAfter(p)}return o.first()};e(document).on("mouseover",h,function(){j=e(this).data("suggest-index");e(document).trigger("suggestable-item-select",[e(this)])}).on("mouseout",h,function(){j=-1;e(document).trigger("suggestable-item-unselect",[e(this)])}).on("mouseup",function(m){var n=e("."+i["container-class"]);if(!n.is(m.target)&&n.has(m.target).size()===0){e(document).trigger("suggestable-hide",[n])}}).on("suggestable-hide",function(m,n){n.hide()}).on("suggestable-show",function(m,n){j=-1;n.show()}).on("suggestable-item-select",function(n,m){m.closest("."+i["container-class"]).children().removeClass(i["item-active-class"]);m.addClass(i["item-active-class"])}).on("suggestable-item-unselect",function(n,m){m.removeClass(i["item-active-class"])});e(this).attr("autocomplete","off").on("keydown",function(m){var n=(m.keyCode||m.which),p=e(this),o=l(p);if(o.is(":visible")){switch(n){case (b||f):o.find("[data-suggest-index="+j+"]").trigger("click");break;case c:if(j===-1||j<=e(h,o).first().data("suggest-index")){j=e(h,o).last().data("suggest-index")}else{j=o.find("[data-suggest-index="+(j-1)+"]").data("suggest-index")}o.find("[data-suggest-index="+j+"]").trigger("mouseover");break;case d:if(j===-1||j>=e(h,o).last().data("suggest-index")){j=e(h,o).first().data("suggest-index")}else{j=o.find("[data-suggest-index="+(j+1)+"]").data("suggest-index")}o.find("[data-suggest-index="+j+"]").trigger("mouseover");break}if([d,c,b,f].indexOf(n)!==-1&&j!==-1){return false}}e(document).on("click",h,function(){p.val(e(this).data("suggest-data"));e(document).trigger("suggestable-hide",[o]).trigger("suggestable-click",[e(this)])});return true}).on("keyup",function(p){var s=e(this),q=(p.keyCode||p.which),r=l(s),m=s.data(i["data-url"]),n=s.val(),o=function(u){var v=0,t=e("<li/>",{"class":i["item-class"]}).hide();if(u.length>0){r.empty();for(v=0;v<u.length;v++){t.empty();t.append(e("<span/>",{"class":i["term-class"]}).text(n)).append(e("<span/>",{"class":i["suggest-class"]}).text(u[v].substr(n.length))).attr("data-suggest-data",u[v]).attr("data-suggest-index",v);r.append(t.show().clone())}e(document).trigger("suggestable-show",[r])}};if([d,c].indexOf(q)===-1){if(n.length>=i["term-min-length"]){if(!g.hasOwnProperty(m+":"+n)){e.get(m,{term:n},function(t){g[m+":"+n]=t;o(g[m+":"+n])},"json")}else{o(g[m+":"+n])}}else{e(document).trigger("suggestable-hide",[r])}}if(r.is(":visible")&&q===a){e(document).trigger("suggestable-hide",[l(s)]);return false}return true})}}(jQuery));