!function(l){"use strict";var d=38,o=40,m=13,f=108,h=27;l.fn.suggestable=function(e){var r=l.extend({"data-url":"suggestable-url","container-class":"suggestable-container","item-class":"suggestable-item","item-active-class":"suggestable-item-active","term-class":"suggestable-term","suggest-class":"suggestable-suggest","delimiter-text":" â€” ","delimiter-class":"suggestable-delimiter","text-class":"suggestable-text","term-min-length":3},e),n="."+r["item-class"],i=-1,u={},c=function(e){var t=(e.attr("id")||"sb"+Math.round(9999*Math.random())+1)+"__container",s=l("#"+t);return s.length<1?l("<ul/>",{class:r["container-class"],id:t}).css({"margin-top":e.outerHeight(!0)+"px",display:"none"}).insertAfter(e):s.first()};l(document).on("mouseover",n,function(e){i=l(e.currentTarget).data("suggest-index"),l(document).trigger("suggestable-item-select",[l(e.currentTarget)])}).on("mouseout",n,function(e){i=-1,l(document).trigger("suggestable-item-unselect",[l(e.currentTarget)])}).on("mouseup",function(e){var t=l("."+r["container-class"]);t.is(e.target)||0!==t.has(e.target).length||l(document).trigger("suggestable-hide",[t])}).on("suggestable-hide",function(e,t){t.hide()}).on("suggestable-show",function(e,t){i=-1,t.show()}).on("suggestable-item-select",function(e,t){t.closest("."+r["container-class"]).children().removeClass(r["item-active-class"]),t.addClass(r["item-active-class"])}).on("suggestable-item-unselect",function(e,t){t.removeClass(r["item-active-class"])}),l(this).attr("autocomplete","off").on("keydown",function(e){var t,s=e.keyCode||e.which,a=l(e.currentTarget),g=c(a);if(g.is(":visible")){switch(s){case m||f:g.find("[data-suggest-index="+i+"]").trigger("click");break;case d:i=-1===i||i<=l(n,g).first().data("suggest-index")?l(n,g).last().data("suggest-index"):g.find("[data-suggest-index="+(i-1)+"]").data("suggest-index"),(t=g.find("[data-suggest-index="+i+"]")).trigger("mouseover"),a.val(t.data("suggest-data"));break;case o:i=-1===i||i>=l(n,g).last().data("suggest-index")?l(n,g).first().data("suggest-index"):g.find("[data-suggest-index="+(i+1)+"]").data("suggest-index"),(t=g.find("[data-suggest-index="+i+"]")).trigger("mouseover"),a.val(t.data("suggest-data"))}if(-1!==[o,d,m,f].indexOf(s)&&-1!==i)return!1}return l(document).on("click",n,function(e){a.val(l(e.currentTarget).data("suggest-data")),l(document).trigger("suggestable-hide",[g]).trigger("suggestable-click",[l(e.currentTarget)])}),!0}).on("keyup",function(e){var t=l(e.currentTarget),s=e.keyCode||e.which,a=c(t),g=t.data(r["data-url"]),n=t.val().trim(),i=function(e){var t=0,s=l("<li/>",{class:r["item-class"]}).hide();if(0<e.length){for(a.empty(),t=0;t<e.length;t++)s.empty(),s.append(l("<span/>",{class:r["term-class"]}).text(n)).append(l("<span/>",{class:r["suggest-class"]}).text(e[t].query.substr(n.length))).attr("data-suggest-data",e[t].query).attr("data-suggest-index",t).attr("data-suggest-url",e[t]["suggest-url"]),""!==e[t]["suggest-text"]&&s.append(l("<span/>",{class:r["delimiter-class"]}).text(r["delimiter-text"])).append(l("<span/>",{class:r["text-class"]}).text(e[t]["suggest-text"])),a.append(s.show().clone());l(document).trigger("suggestable-show",[a])}};return-1===[o,d,m,f,h].indexOf(s)&&(n.length>=r["term-min-length"]?u.hasOwnProperty(g+":"+n)?i(u[g+":"+n]):l.get(g,{term:n},function(e){u[g+":"+n]=e,i(u[g+":"+n])},"json"):l(document).trigger("suggestable-hide",[a])),!a.is(":visible")||s!==h||(l(document).trigger("suggestable-hide",[c(t)]),!1)})}}(jQuery);
